{"version":3,"sources":["UserMgr.js"],"names":["cc","Class","extends","Component","properties","account","userId","userName","lv","exp","coins","gems","sign","ip","sex","roomData","oldRoomId","new","bankerId","isReady","guestAuth","Date","now","sys","localStorage","setItem","vv","http","sendRequest","onAuth","ret","self","userMgr","errcode","console","log","errmsg","url","SI","hall","createRole","login","name","onCreate","data","onLogin","userid","roomid","director","loadScene","createRoom","conf","callback","gameNetMgr","connectGameServer","JSON","stringify","enterRoom","roomId","getHistoryList","onGet","history","getGamesOfRoom","uuid","getDetailOfGame","index","getIsBanker","setBankerId","getBankerId"],"mappings":"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","file":"UserMgr.js","sourceRoot":"../../../../../assets/sprite/common","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        account: null,\n        userId: null,\n        userName: null,\n        lv: 0,\n        exp: 0,\n        coins: 0,\n        gems: 0,\n        sign: 0,\n        ip: \"\",\n        sex: 0,\n        roomData: null,\n        oldRoomId: null,\n        new: false,\n        bankerId: -1,\n        isReady: false,\n    },\n\n    guestAuth: function () {\n        let account = null\n        // if (account == null) {\n        //     account = cc.sys.localStorage.getItem(\"account\");\n        // }\n        if (account == null) {\n            this.new = true\n            account = Date.now();\n            cc.sys.localStorage.setItem(\"account\", account);\n        }\n        cc.vv.http.sendRequest(\"/guest\", { account: account }, this.onAuth);\n    },\n\n    onAuth: function (ret) {\n        var self = cc.vv.userMgr;\n        if (ret.errcode !== 0) {\n            console.log(ret.errmsg);\n        }\n        else {\n            self.account = ret.account;\n            self.sign = ret.sign;\n            cc.vv.http.url = \"http://\" + cc.vv.SI.hall;\n            if (self.new) {\n                self.createRole(\"Forothy\");\n            }\n            else {\n                self.login()\n            }\n        }\n    },\n\n    createRole: function (name) {\n        var self = this;\n        var onCreate = function (ret) {\n            if (ret.errcode !== 0) {\n                console.log(ret.errmsg);\n            }\n            else {\n                self.login();\n            }\n        };\n\n        var data = {\n            account: this.account,\n            sign: this.sign,\n            name: name\n        };\n        cc.vv.http.sendRequest(\"/create_user\", data, onCreate);\n    },\n\n    login: function () {\n        var self = this;\n        let onLogin = function (ret) {\n            console.log(\"onLogin\")\n            if (ret.errcode !== 0) {\n                console.log(ret.errmsg);\n            }\n            else {\n                console.log(ret);\n                console.log(ret.account)\n                console.log(ret.name)\n                self.account = ret.account;\n                self.userId = ret.userid;\n                self.userName = ret.name;\n                self.lv = ret.lv;\n                self.exp = ret.exp;\n                self.coins = ret.coins;\n                self.gems = ret.gems;\n                self.roomData = ret.roomid;\n                self.sex = ret.sex;\n                self.ip = ret.ip;\n                // 登陆成功\n                cc.director.loadScene(\"gamehall\")\n            }\n        };\n        console.log(this.account)\n        cc.vv.http.sendRequest(\"/login\", { account: this.account, sign: this.sign }, onLogin);\n    },\n\n    createRoom: function (conf, callback)  {\n        var onCreate = function (ret) {\n            if (ret.errcode !== 0) {\n                if (callback && typeof(callback) == \"function\") {\n                    callback(ret)\n                }\n            }\n            else {\n                cc.vv.gameNetMgr.connectGameServer(ret);\n            }\n        };\n\n        var data = {\n            account: cc.vv.userMgr.account,\n            sign: cc.vv.userMgr.sign,\n            conf: JSON.stringify(conf)\n        };\n        cc.vv.http.sendRequest(\"/create_private_room\", data, onCreate);\n    },\n\n    enterRoom: function (roomId, callback) {\n        let enterRoom = function (ret) {\n            if (ret.errcode !== 0) {\n                if (callback && typeof(callback) == \"function\") {\n                    callback(ret);\n                }\n            }\n            else {\n                if (callback && typeof(callback) == \"function\") {\n                    callback(ret);\n                }\n                cc.vv.gameNetMgr.connectGameServer(ret);\n            }\n        };\n        let data = {\n            account: cc.vv.userMgr.account,\n            sign: cc.vv.userMgr.sign,\n            roomid: roomId\n        };\n        cc.vv.http.sendRequest(\"/enter_private_room\", data, enterRoom);\n    },\n\n    getHistoryList: function (callback) {\n        var self = this;\n        var onGet = function (ret) {\n            if (ret.errcode !== 0) {\n                console.log(ret.errmsg);\n            }\n            else {\n                console.log(ret.history);\n                if (callback != null) {\n                    callback(ret.history);\n                }\n            }\n        };\n        var data = {\n            account: cc.vv.userMgr.account,\n            sign: cc.vv.userMgr.sign,\n        };\n        cc.vv.http.sendRequest(\"/get_history_list\", data, onGet);\n    },\n\n    getGamesOfRoom: function (uuid, callback) {\n        var self = this;\n        var onGet = function (ret) {\n            if (ret.errcode !== 0) {\n                console.log(ret.errmsg);\n            }\n            else {\n                console.log(ret.data);\n                callback(ret.data);\n            }\n        };\n        var data = {\n            account: cc.vv.userMgr.account,\n            sign: cc.vv.userMgr.sign,\n            uuid: uuid,\n        };\n        cc.vv.http.sendRequest(\"/get_games_of_room\", data, onGet);\n    },\n\n    getDetailOfGame: function (uuid, index, callback) {\n        var self = this;\n        var onGet = function (ret) {\n            if (ret.errcode !== 0) {\n                console.log(ret.errmsg);\n            }\n            else {\n                console.log(ret.data);\n                callback(ret.data);\n            }\n        };\n        var data = {\n            account: cc.vv.userMgr.account,\n            sign: cc.vv.userMgr.sign,\n            uuid: uuid,\n            index: index,\n        };\n        cc.vv.http.sendRequest(\"/get_detail_of_game\", data, onGet);\n    },\n\n    getIsBanker () {\n        return this.bankerId == this.userId\n    },\n\n    setBankerId (bankerId) {\n        this.bankerId = bankerId\n    },\n\n    getBankerId () {\n        return this.bankerId\n    }\n});\n"]}