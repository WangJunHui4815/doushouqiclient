{"version":3,"sources":["GameNetMgr.js"],"names":["GameCtrl","require","cc","Class","extends","Component","properties","roomId","maxNumOfGames","numOfGames","seats","gamestate","isOver","dissoveData","dataEventHandler","connectGameServer","data","vv","net","ip","port","console","log","onConnectOK","sd","token","roomid","time","sign","send","onConnectFailed","connect","initHandlers","self","addHandler","director","loadScene","userMgr","oldRoomId","dispatchEvent","errcode","setBankerId","conf","banker","errmsg","getScene","getChildByName","getComponent","initUserInfo","userId","s","getSeatByID","userid","name","seatIndex","seatindex","online","state","canHideCard","hideCardEnd","results","reset","i","length","ready","clear","getSeatIndexByID","seat","getIsBanker","event","emit"],"mappings":"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","file":"GameNetMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\sprite\\Net","sourcesContent":["const GameCtrl = require('gameCtrl')\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        roomId: 0,\r\n        maxNumOfGames: 0,\r\n        numOfGames: 0,\r\n        // seatIndex: -1,\r\n        seats: null,\r\n        gamestate: \"\",\r\n        isOver: false,\r\n        dissoveData: null,\r\n        dataEventHandler: null,\r\n    },\r\n\r\n    connectGameServer: function (data) {\r\n        this.dissoveData = null;\r\n        cc.vv.net.ip = data.ip + \":\" + data.port;\r\n        console.log(cc.vv.net.ip);\r\n        let onConnectOK = function () {\r\n            console.log(\"onConnectOK\");\r\n            var sd = {\r\n                token: data.token,\r\n                roomid: data.roomid,\r\n                time: data.time,\r\n                sign: data.sign,\r\n            };\r\n            cc.vv.net.send(\"login\", sd);\r\n        };\r\n\r\n        let onConnectFailed = function () {\r\n            console.log(\"onConnectFailed\");\r\n        };\r\n\r\n        cc.vv.net.connect(onConnectOK, onConnectFailed);\r\n    },\r\n\r\n    initHandlers: function () {\r\n        const self = this;\r\n        cc.vv.net.addHandler(\"disconnect\", function (data) {\r\n            if (self.roomId == null) {\r\n                cc.director.loadScene(\"hall\");\r\n            }\r\n            else {\r\n                if (self.isOver == false) {\r\n                    cc.vv.userMgr.oldRoomId = self.roomId;\r\n                    self.dispatchEvent(\"disconnect\");\r\n                }\r\n                else {\r\n                    self.roomId = null;\r\n                }\r\n            }\r\n        });\r\n        // 创建or进入房间\r\n        cc.vv.net.addHandler(\"login_result\", function (data) {\r\n            console.log(\"login_result\");\r\n            console.log(data);\r\n            if (data.errcode === 0) {\r\n                var data = data.data;\r\n                self.roomId = data.roomid;\r\n                // self.maxNumOfGames = data.conf.maxGames;\r\n                // self.numOfGames = data.numofgames;\r\n                self.seats = data.seats;\r\n                // self.seatIndex = self.getSeatIndexByID(cc.vv.userMgr.userId);\r\n                self.isOver = false;\r\n                cc.vv.userMgr.setBankerId(data.conf.banker)\r\n                cc.log(data.conf.banker)\r\n            }\r\n            else {\r\n                console.log(data.errmsg);\r\n            }\r\n        });\r\n\r\n        // 创建or进入房间成功    \r\n        cc.vv.net.addHandler(\"login_finished\", function (data) {\r\n            console.log(\"login_finished\");\r\n            cc.director.loadScene(\"guessgame\", () => {\r\n                // 初始化玩家信息\r\n                cc.log(\"initUserinfo\")\r\n                cc.log(self.seats)\r\n                cc.director.getScene().getChildByName(\"gameCtrl\").getComponent(GameCtrl).initUserInfo(self.seats)\r\n            });\r\n        });\r\n\r\n        // 解散房间\r\n        cc.vv.net.addHandler(\"dispress_push\", function (data) {\r\n            self.roomId = 0;\r\n            self.seats = null;\r\n        });\r\n\r\n        cc.vv.net.addHandler(\"dissolve_notice_push\", function (data) {\r\n            console.log(\"dissolve_notice_push\");\r\n            console.log(data);\r\n            self.dissoveData = data;\r\n            self.dispatchEvent(\"dissolve_notice\", data);\r\n        });\r\n\r\n        cc.vv.net.addHandler(\"dissolve_cancel_push\", function (data) {\r\n            self.dissoveData = null;\r\n            self.dispatchEvent(\"dissolve_cancel\", data);\r\n        });\r\n\r\n        // 退出\r\n        cc.vv.net.addHandler(\"exit_result\", function (data) {\r\n            self.roomId = 0;\r\n            self.seats = null;\r\n        });\r\n\r\n        // 退出广播\r\n        cc.vv.net.addHandler(\"exit_notify_push\", function (data) {\r\n            var userId = data;\r\n            var s = self.getSeatByID(userId);\r\n            if (s != null) {\r\n                s.userid = 0;\r\n                s.name = \"\";\r\n                self.dispatchEvent(\"user_state_changed\", s);\r\n            }\r\n        });\r\n\r\n        // 新玩家进入\r\n        cc.vv.net.addHandler(\"new_user_comes_push\", function (data) {\r\n            console.log(\"new_user_comes_push\");\r\n            cc.log(data)\r\n            const seatIndex = data.seatindex;\r\n            if (self.seats[seatIndex].userid > 0) {\r\n                self.seats[seatIndex].online = true;\r\n            }\r\n            else {\r\n                data.online = true;\r\n                self.seats[seatIndex] = data;\r\n            }\r\n            self.dispatchEvent('new_user_comein', self.seats[seatIndex]);\r\n        });\r\n\r\n        // 玩家断线通知\r\n        cc.vv.net.addHandler(\"user_state_push\", function (data) {\r\n            console.log(\"user_state_push\");\r\n            console.log(data)\r\n            self.dispatchEvent('user_state_changed', { userid: data.userid, state: data.online });\r\n        });\r\n\r\n        // 玩家准备通知\r\n        cc.vv.net.addHandler(\"user_ready_push\", function (data) {\r\n            console.log(\"user_ready_push\");\r\n            console.log(data);\r\n            var userId = data.userid;\r\n            // seat.ready = data.ready;\r\n            self.dispatchEvent('user_state_changed', data);\r\n        });\r\n\r\n        // 房卡数量\r\n        cc.vv.net.addHandler(\"game_num_push\", function (data) {\r\n            cc.log(\"game_num_push\" + data)\r\n            self.numOfGames = data;\r\n            self.dispatchEvent('game_num', data);\r\n        });\r\n\r\n        // 游戏状态：begin\r\n        cc.vv.net.addHandler(\"game_begin_push\", function (data) {\r\n            console.log('game_begin_push');\r\n            self.gamestate = \"begin\";\r\n            self.dispatchEvent('game_begin');\r\n        });\r\n\r\n        // 游戏状态：playing\r\n        cc.vv.net.addHandler(\"game_playing_push\", function (data) {\r\n            console.log('game_playing_push');\r\n            self.gamestate = \"playing\";\r\n            self.dispatchEvent('game_playing');\r\n        });\r\n\r\n        // 通知庄家开始藏牌 data 1：庄家 -1:其他玩家\r\n        cc.vv.net.addHandler(\"game_cangpai_push\", function (data) {\r\n            console.log('game_cangpai_push');\r\n            self.canHideCard();\r\n        });\r\n\r\n        // 庄家藏牌，其他玩家开始猜牌\r\n        cc.vv.net.addHandler(\"game_cangpai_notify_push\", function (data) {\r\n            console.log('game_cangpai_notify_push');\r\n            console.log(data);\r\n            self.hideCardEnd()\r\n        });\r\n\r\n        // 其他玩家猜牌\r\n        cc.vv.net.addHandler(\"game_caipai_notify_push\", function (data) {\r\n            console.log(\"game_caipai_notify_push\")\r\n            console.log(data)\r\n            self.dispatchEvent('guess_card_result', data);\r\n        });\r\n\r\n        // 对比结果，结算\r\n        cc.vv.net.addHandler(\"game_over_push\", function (data) {\r\n            console.log('game_over_push');\r\n            console.log(data)\r\n            var results = data.results;\r\n            self.dispatchEvent('game_over', results)\r\n        });\r\n\r\n        // 聊天相关\r\n        cc.vv.net.addHandler(\"chat_push\", function (data) {\r\n            self.dispatchEvent(\"chat_push\",data)\r\n            cc.log(data)\r\n        });\r\n\r\n        cc.vv.net.addHandler(\"quick_chat_push\", function (data) {\r\n            // self.dispatchEvent(\"quick_chat_push\",data);\r\n        });\r\n\r\n        cc.vv.net.addHandler(\"emoji_push\", function (data) {\r\n            self.dispatchEvent(\"emoji_push\",data);\r\n            cc.log(data)\r\n        });\r\n\r\n\r\n    },\r\n\r\n    reset: function () {\r\n        this.gamestate = \"\";\r\n        for (var i = 0; i < this.seats.length; ++i) {\r\n            this.seats[i].ready = false;\r\n        }\r\n    },\r\n\r\n    clear: function () {\r\n        this.dataEventHandler = null;\r\n        if (this.isOver == null) {\r\n            this.seats = null;\r\n            this.roomId = null;\r\n            this.maxNumOfGames = 0;\r\n            this.numOfGames = 0;\r\n        }\r\n    },\r\n\r\n    getSeatByID: function (userId) {\r\n        var seatIndex = this.getSeatIndexByID(userId);\r\n        var seat = this.seats[seatIndex];\r\n        return seat;\r\n    },\r\n\r\n    getSeatIndexByID: function (userId) {\r\n        for (var i = 0; i < this.seats.length; ++i) {\r\n            var s = this.seats[i];\r\n            if (s.userid == userId) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    canHideCard: function () {\r\n        console.log(\"canHideCard\")\r\n        if (cc.vv.userMgr.getIsBanker()) {\r\n            this.dispatchEvent('can_hide_card');\r\n        }\r\n    },\r\n\r\n    hideCardEnd: function () {\r\n        console.log(\"hideCardEnd\")\r\n        if (!cc.vv.userMgr.getIsBanker()) {\r\n            this.dispatchEvent('can_guess_card');\r\n        }\r\n        else {\r\n            this.dispatchEvent('hide_card_success');\r\n        }\r\n    },\r\n\r\n    // 发射事件\r\n    dispatchEvent(event, data) {\r\n        if (this.dataEventHandler) {\r\n            this.dataEventHandler.emit(event, data);\r\n        }\r\n    },\r\n});\r\n"]}